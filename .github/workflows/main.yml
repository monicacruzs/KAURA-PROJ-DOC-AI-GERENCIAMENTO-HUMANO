# Nome do workflow (aparece no GitHub Actions)
name: Document AI Execution - CI

# Quando o workflow deve ser executado (a cada push na branch main)
on:
  push:
    branches:
      - main

# Define os trabalhos (jobs) que o workflow deve executar
jobs:
  analyze-document:
    # O ambiente onde o c칩digo ser치 executado (ambiente Linux hospedado no GitHub)
    runs-on: ubuntu-latest

    # Vari치veis de ambiente secretas (para o Azure)
    env:
      # O GitHub Actions N츾O L칅 o arquivo .env.
      # Voc칡 precisa adicionar estas vari치veis nas "Secrets" do seu reposit칩rio no GitHub.
      AZURE_FORM_RECOGNIZER_ENDPOINT: ${{ secrets.AZURE_FORM_RECOGNIZER_ENDPOINT }}
      AZURE_FORM_RECOGNIZER_KEY: ${{ secrets.AZURE_FORM_RECOGNIZER_KEY }}

    # As etapas (steps) para executar o c칩digo
    steps:
      # 1. Checkout: Clona o c칩digo do seu reposit칩rio
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Configura o Python: Garante que a vers칚o correta do Python est치 instalada
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 3. Instala as depend칡ncias: Instala os pacotes necess치rios (do requirements.txt)
      - name: Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          pip install -r requirements.txt
          
     # 4. Executa o script principal (Projeto 2: Faturas)
      - name: 4. Execute Document Analysis Script (Projeto 2)
        # Usa o par칙metro --model-id para executar o modo de extra칞칚o de fatura
        # O script Python gerar치 o arquivo dados_fatura_extraidos.json neste passo.
        run: |
          python3 src/analyze_doc_ai.py --model-id prebuilt-invoice

      # 5. Salva o Output como Artefato
      - name: 5. Upload Output Artifact (JSON) 游닍
        # A칞칚o oficial para salvar arquivos.
        uses: actions/upload-artifact@v4
        with:
          # Nome do Artefato na p치gina de resumo da execu칞칚o
          name: kaura-proj2-fatura-output-${{ github.run_id }}
          # O caminho (path) deve ser o nome do arquivo gerado pelo script Python
          path: dados_fatura_extraidos.json           
          # Define o tempo de reten칞칚o do arquivo no GitHub (em dias)
          retention-days: 7
